var Built = require('built.io');
/**
 * This middleware wraps the the request body into js sdk wrappers
 */

module.exports = function (req, res, next) {
	var configs  = this.app.getConfig()
	req.Built    = Built
	req.builtApp = Built.App(configs.application_api_key, configs)

	if(req.payload.device_id){
		req.builtApp = req.builtApp.setDeviceID(req.payload.device_id)	
	}

	if(req.payload.access_token) {
		req.builtApp = req.builtApp.setHeader("access_token", req.payload.access_token)
	} else if(req.payload.authtoken) {
		req.builtApp = req.builtApp.setHeader("authtoken", req.payload.authtoken)
	}
	
	next()
}